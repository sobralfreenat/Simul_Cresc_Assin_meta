<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Crescimento de Assinantes</title>
    <!-- Adicionando a biblioteca Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Simulador de Crescimento de Assinantes</h1>

    <br> <!-- Adicionando espaço abaixo do título -->

    <label for="visualizadoresDiarios">Visualizadores Diários:</label>
    <input type="number" id="visualizadoresDiarios" value="2500"><br>
    <label for="taxaConversao">Taxa de Conversão (%):</label>
    <input type="number" id="taxaConversao" value="3"><br>
    <label for="taxaRetencao">Taxa de Retenção (%):</label>
    <input type="number" id="taxaRetencao" value="70"><br>
    <label for="assinantesIniciais">Assinantes Iniciais:</label>
    <input type="number" id="assinantesIniciais" value="25"><br>
    <label for="metaAssinantes">Meta de Assinantes:</label>
    <input type="number" id="metaAssinantes" value="7000"><br>
    <label for="aceleracaoCrescimento">Aceleração de Crescimento (%):</label>
    <input type="number" id="aceleracaoCrescimento" value="0"><br>
    <label for="tipoGrafico">Tipo de Gráfico:</label>
    <select id="tipoGrafico">
        <option value="lines">Linhas</option>
        <option value="bar">Barras</option>
    </select><br>

    <!-- Adicionando um contêiner para o gráfico Plotly -->
    <div id="myPlot"></div>

    <!-- Adicionando checkbox para habilitar/desabilitar o zoom -->
    <label for="toggleZoom">Habilitar Zoom:</label>
    <input type="checkbox" id="toggleZoom"><br>

    <script>
        // Variável para armazenar o estado do zoom
        var zoomState = {};

        // Função para simular o crescimento dos assinantes com base nos parâmetros fornecidos
        function simularCrescimento() {
            var visualizadoresDiarios = parseInt(document.getElementById('visualizadoresDiarios').value);
            var taxaConversao = parseFloat(document.getElementById('taxaConversao').value) / 100;
            var taxaRetencao = parseFloat(document.getElementById('taxaRetencao').value) / 100;
            var assinantesIniciais = parseInt(document.getElementById('assinantesIniciais').value);
            var metaAssinantes = parseInt(document.getElementById('metaAssinantes').value);
            var aceleracaoCrescimento = parseFloat(document.getElementById('aceleracaoCrescimento').value) / 100;
            var tipoGrafico = document.getElementById('tipoGrafico').value;
            var dias = 0;

            // Dados para o gráfico Plotly
            var data = [{
                x: [],
                y: [],
                type: tipoGrafico,
                name: 'Número de Assinantes (Crescimento Normal)',
                line: {color: 'blue', opacity: 0.7} // Definindo a cor da linha de crescimento normal como azul e transparência
            }];

            // Simulação do crescimento dos assinantes (crescimento normal)
            var assinantes = assinantesIniciais;
            while (assinantes < metaAssinantes) {
                dias++;
                assinantes += visualizadoresDiarios * taxaConversao * taxaRetencao;
                data[0].x.push(dias);
                data[0].y.push(Math.round(assinantes)); // Arredonda para o número inteiro mais próximo
            }

            // Simulação do crescimento acelerado
            if (aceleracaoCrescimento > 0) {
                var assinantesAcelerado = assinantesIniciais;
                var dadosAcelerados = {
                    x: [],
                    y: [],
                    type: tipoGrafico,
                    name: 'Número de Assinantes (Crescimento Acelerado)',
                    marker: {color: '#8ebda7', opacity: 0.7} // Definindo a cor das barras do crescimento acelerado como verde e transparência
                };
                for (var i = 0; i < dias; i++) {
                    assinantesAcelerado *= (1 + taxaConversao * taxaRetencao * (1 + aceleracaoCrescimento));
                    dadosAcelerados.x.push(i + 1);
                    dadosAcelerados.y.push(Math.round(assinantesAcelerado)); // Arredonda para o número inteiro mais próximo
                }
                data.push(dadosAcelerados);
            }

            // Adicionar linha de meta de assinantes
            var metaData = Array(dias).fill(metaAssinantes);
            var metaDataObj = {
                x: data[0].x,
                y: metaData,
                type: tipoGrafico === 'bar' ? 'scatter' : 'scatter',
                name: 'Meta de Assinantes',
                line: {color: 'orange', opacity: 0.7} // Definindo a cor da linha da meta como laranja e transparência
            };
            data.push(metaDataObj);

            // Layout do gráfico Plotly
            var layout = {
                title: 'Crescimento de Assinantes',
                xaxis: {
                    title: 'Dias'
                },
                yaxis: {
                    title: 'Número de Assinantes'
                }
            };

            // Gerar o gráfico Plotly
            Plotly.newPlot('myPlot', data, layout);

            // Salvar estado do zoom
            zoomState = document.getElementById('myPlot').layout.xaxis.range;
        }

        // Função para alternar entre visão total e zoom atual
        function toggleZoom() {
            var plotDiv = document.getElementById('myPlot');
            var layout = plotDiv.layout;

            if (layout.xaxis.autorange === true) {
                // Se estiver na visão total, aplicar o zoom salvo
                layout.xaxis.range = zoomState;
                layout.yaxis.range = zoomState;
            } else {
                // Se estiver em zoom, voltar para a visão total
                layout.xaxis.autorange = true;
                layout.yaxis.autorange = true;
            }

            // Atualizar o gráfico
            Plotly.react('myPlot', plotDiv.data, layout);
        }

        // Adicionando event listeners para atualizar em tempo real ao alterar os parâmetros
        var inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
            input.addEventListener('change', simularCrescimento);
        });

        var select = document.getElementById('tipoGrafico');
        select.addEventListener('change', simularCrescimento);

        var checkbox = document.getElementById('toggleZoom');
        checkbox.addEventListener('change', toggleZoom);

        // Chamando a função inicialmente para gerar o gráfico com os valores padrão
        simularCrescimento();
    </script>
</body>
</html>
